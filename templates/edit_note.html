{% extends "base.html" %}

{% block title %}Edit Note - My Literary Canvas{% endblock %}
{% block breadcrumbs %}
    {{ super() }}
    <span class="mx-2 text-gray-400">/</span>
    <a href="{{ url_for('main.notes') }}" class="text-indigo-600 hover:text-indigo-800 flex items-center">
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
        </svg>
        Notes
    </a>
    <span class="mx-2 text-gray-400">/</span>
    <a href="{{ url_for('main.view_note', note_id=note.id) }}" class="text-indigo-600 hover:text-indigo-800 flex items-center">
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
        </svg>
        {{ note.title }}
    </a>
    <span class="mx-2 text-gray-400">/</span>
    <span class="text-blue-600 flex items-center">
        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
        </svg>
        Edit
    </span>
{% endblock %}

{% block content %}
<div class="min-h-screen py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-5xl font-extrabold text-center mb-12">
            <span class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-600 via-purple-500 to-pink-500">
                Craft Your Masterpiece
            </span>
        </h1>
        
        <form method="POST" enctype="multipart/form-data" class="space-y-8">
            {{ form.hidden_tag() }}
            <div class="bg-white shadow-2xl rounded-3xl p-10 space-y-8 relative overflow-hidden border-4 border-indigo-100">
                <div class="relative group">
                    {{ form.title.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    <div class="flex items-center bg-gray-50 rounded-lg p-2 transition-all duration-300 focus-within:ring-2 focus-within:ring-indigo-500">
                        <svg class="w-6 h-6 text-indigo-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path>
                        </svg>
                        {{ form.title(class="bg-transparent focus:outline-none w-full text-lg") }}
                    </div>
                </div>
                
                <div class="relative group">
                    {{ form.summary.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    <div class="flex items-start bg-gray-50 rounded-lg p-2 transition-all duration-300 focus-within:ring-2 focus-within:ring-indigo-500">
                        <svg class="w-6 h-6 text-indigo-500 mr-3 mt-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                        {{ form.summary(class="bg-transparent focus:outline-none w-full", rows="3") }}
                    </div>
                </div>
                
                <div class="relative group">
                    {{ form.content.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    <div class="bg-gray-50 rounded-lg p-2 transition-all duration-300 focus-within:ring-2 focus-within:ring-indigo-500">
                        <div id="toolbar" class="flex space-x-2 mb-2">
                            <button type="button" data-command="bold" class="p-1 rounded hover:bg-gray-200">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M13.5 10a3.5 3.5 0 11-7 0 3.5 3.5 0 017 0zm-1.5 0a2 2 0 10-4 0 2 2 0 004 0z"/></svg>
                            </button>
                            <button type="button" data-command="italic" class="p-1 rounded hover:bg-gray-200">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6 3h8l-1 13H5l1-13zm2.5 3a.5.5 0 01.5.5v3a.5.5 0 01-1 0v-3a.5.5 0 01.5-.5z"/></svg>
                            </button>
                            <button type="button" data-command="underline" class="p-1 rounded hover:bg-gray-200">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M6 3v7a4 4 0 108 0V3h2v7a6 6 0 11-12 0V3h2zm8 14H6v-2h8v2z"/></svg>
                            </button>
                            <button type="button" data-command="insertUnorderedList" class="p-1 rounded hover:bg-gray-200">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 5h12v2H7V5zm0 4h12v2H7V9zm0 4h12v2H7v-2zm-4-8a1 1 0 110 2 1 1 0 010-2zm0 4a1 1 0 110 2 1 1 0 010-2zm0 4a1 1 0 110 2 1 1 0 010-2z"/></svg>
                            </button>
                            <button type="button" data-command="insertOrderedList" class="p-1 rounded hover:bg-gray-200">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 5h12v2H3V5zm0 4h12v2H3V9zm0 4h12v2H3v-2zm-1-8h1v1H2V5zm0 4h1v1H2V9zm0 4h1v1H2v-1z"/></svg>
                            </button>
                        </div>
                        {{ form.content(id="hidden-content", class="hidden") }}
                        <div id="editor" contenteditable="true" class="min-h-[300px] p-2 bg-white border border-gray-300 rounded focus:outline-none focus:border-indigo-500"></div>
                    </div>
                </div>
                
                <div class="relative">
                    {{ form.subject.label(class="block text-sm font-medium text-gray-700 mb-2") }}
                    <div class="flex items-center bg-gray-50 rounded-lg p-2 transition-all duration-300 focus-within:ring-2 focus-within:ring-indigo-500">
                        <svg class="w-6 h-6 text-indigo-500 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
                        </svg>
                        {{ form.subject(class="bg-transparent focus:outline-none w-full") }}
                    </div>
                </div>
                
                <div class="flex justify-between items-center mt-12">
                    <button type="button" id="text-to-speech" class="flex items-center px-6 py-3 bg-gradient-to-r from-green-400 to-blue-500 text-white rounded-full hover:from-green-500 hover:to-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200 transform hover:scale-105">
                        <svg id="play-icon" class="w-6 h-6 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <svg id="pause-icon" class="w-6 h-6 mr-2 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <span id="tts-text">Read Aloud</span>
                    </button>
                    {{ form.submit(class="px-8 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 text-white rounded-full hover:from-indigo-600 hover:to-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition-colors duration-200 transform hover:scale-105") }}
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    const editor = document.getElementById('editor');
    const hiddenContent = document.getElementById('hidden-content');
    const toolbar = document.getElementById('toolbar');

    // Initialize editor content
    editor.innerHTML = hiddenContent.value;

    // Rich text editing functions
    function execCommand(command) {
        document.execCommand(command, false, null);
    }

    toolbar.addEventListener('click', function(e) {
        const button = e.target.closest('button');
        if (button) {
            e.preventDefault();
            execCommand(button.dataset.command);
        }
    });

    // Update hidden input on form submission
    document.querySelector('form').addEventListener('submit', function() {
        hiddenContent.value = editor.innerHTML;
    });

    // Text-to-speech functionality
    let isReading = false;
    let utterance = null;

    document.getElementById('text-to-speech').addEventListener('click', function() {
        const text = editor.innerText;
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const ttsText = document.getElementById('tts-text');

        if (!isReading) {
            utterance = new SpeechSynthesisUtterance(text);
            window.speechSynthesis.speak(utterance);
            isReading = true;
            playIcon.classList.add('hidden');
            pauseIcon.classList.remove('hidden');
            ttsText.textContent = 'Pause';
        } else {
            window.speechSynthesis.pause();
            isReading = false;
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            ttsText.textContent = 'Resume';
        }

        utterance.onend = function() {
            isReading = false;
            playIcon.classList.remove('hidden');
            pauseIcon.classList.add('hidden');
            ttsText.textContent = 'Read Aloud';
        };
    });
</script>
{% endblock %}